{% extends "base.html" %}

{% block content %}
<!-- Algorithm sections -->
<div id="f2l-section" class="algorithm-section">
  <!-- Non-sticky PLL header -->
  <div class="pt-2 mb-4">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-gray-100 text-2xl font-bold mb-3">
        {{ cofp_algorithms.f2l.title }}
      </h2>
      <p class="text-gray-medium">{{ cofp_algorithms.f2l.description }}</p>
    </div>
  </div>

  {% for group in cofp_algorithms.f2l.groups %}
  <div class="mb-12 oll-group" data-group-name="{{ group.description }}">
    <h3 class="text-xl font-semibold mb-6 border-b border-gray-200 pb-2">
      {{ group.description }}
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      {% for algorithm in group.algorithms %}
      <div
        class="card bg-base-100 card-xs shadow-sm oll-algorithm"
        data-algorithm-name="{{ algorithm.name|lower }}"
      >
        <div class="card-body">
          <h2 class="card-title">{{ algorithm.name }}</h2>

          <div class="space-y-4">
            <!-- Image and description area -->
            <div class="flex gap-4 items-start">
              {% if algorithm.image_url is not none %}
              <div class="flex-shrink-0">
                <img
                  src="{{ algorithm.image_url }}"
                  alt="{{ algorithm.name }}"
                  class="w-24 h-24 rounded"
                  loading="lazy"
                />
              </div>
              {% endif %}

              <!-- Space for additional text/description -->
              <div class="flex-1 min-w-0 text-gray-300 text-sm">
                <!-- This is where you can add description or notes about the algorithm -->
                <p>Algorithm description or notes can go here...</p>
              </div>
            </div>

            <!-- Moves list below -->
            <div>
              <ul
                class="border border-gray-600 rounded overflow-hidden list-none m-0 p-0"
              >
                {% for move in algorithm.moves %}
                <li
                  class="font-mono text-sm text-gray-100 px-3 py-2 {% if not loop.last %}border-b border-gray-600{% endif %}"
                >
                  {{ move }}
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>

<div id="oll-section" class="algorithm-section hidden">
  <!-- Non-sticky PLL header -->
  <div class="pt-2 mb-4">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-gray-100 text-2xl font-bold mb-3">
        {{ cofp_algorithms.oll.title }}
      </h2>
      <p class="text-gray-medium">{{ cofp_algorithms.oll.description }}</p>
    </div>
  </div>

  <!-- Sticky search field only -->
  <div
    class="sticky z-40 bg-gray-900 mb-4 py-2"
    style="top: var(--header-height, 120px)"
  >
    <div class="max-w-4xl mx-auto">
      <div class="relative max-w-md">
        <input
          type="text"
          id="oll-search"
          placeholder="Search OLL algorithms by name..."
          class="input input-bordered w-full bg-gray-800 text-gray-100 border-gray-600 focus:border-gray-400 pr-10"
        />
        <button
          id="oll-search-clear"
          class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200 hidden"
          onclick="clearOLLSearch()"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  {% for group in cofp_algorithms.oll.groups %}
  <div class="mb-12 oll-group" data-group-name="{{ group.description }}">
    <h3 class="text-xl font-semibold mb-6 border-b border-gray-200 pb-2">
      {{ group.description }}
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      {% for algorithm in group.algorithms %}
      <div
        class="card bg-base-100 card-xs shadow-sm oll-algorithm"
        data-algorithm-name="{{ algorithm.name|lower }}"
      >
        <div class="card-body">
          <h2 class="card-title">{{ algorithm.name }}</h2>

          <div class="space-y-4">
            <!-- Image and description area -->
            <div class="flex gap-4 items-start">
              {% if algorithm.image_url is not none %}
              <div class="flex-shrink-0">
                <img
                  src="{{ algorithm.image_url }}"
                  alt="{{ algorithm.name }}"
                  class="w-24 h-24 rounded"
                  loading="lazy"
                />
              </div>
              {% endif %}

              <!-- Space for additional text/description -->
              <div class="flex-1 min-w-0 text-gray-300 text-sm">
                <!-- This is where you can add description or notes about the algorithm -->
                <p>Algorithm description or notes can go here...</p>
              </div>
            </div>

            <!-- Moves list below -->
            <div>
              <ul
                class="border border-gray-600 rounded overflow-hidden list-none m-0 p-0"
              >
                {% for move in algorithm.moves %}
                <li
                  class="font-mono text-sm text-gray-100 px-3 py-2 {% if not loop.last %}border-b border-gray-600{% endif %}"
                >
                  {{ move }}
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>

<div id="pll-section" class="algorithm-section hidden">
  <!-- Non-sticky PLL header -->
  <div class="pt-2 mb-4">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-gray-100 text-2xl font-bold mb-3">
        {{ cofp_algorithms.pll.title }}
      </h2>
      <p class="text-gray-medium">{{ cofp_algorithms.pll.description }}</p>
    </div>
  </div>

  <!-- Sticky search field only -->
  <div
    class="sticky z-40 bg-gray-900 mb-4 py-2"
    style="top: var(--header-height, 120px)"
  >
    <div class="max-w-4xl mx-auto">
      <div class="relative max-w-md">
        <input
          type="text"
          id="pll-search"
          placeholder="Search PLL algorithms by name..."
          class="input input-bordered w-full bg-gray-800 text-gray-100 border-gray-600 focus:border-gray-400 pr-10"
        />
        <button
          id="pll-search-clear"
          class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-200 hidden"
          onclick="clearPLLSearch()"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  {% for group in cofp_algorithms.pll.groups %}
  <div class="mb-12 pll-group" data-group-name="{{ group.description }}">
    <h3 class="text-xl font-semibold mb-6 border-b border-gray-200 pb-2">
      {{ group.description }}
    </h3>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      {% for algorithm in group.algorithms %}
      <div
        class="card bg-base-100 card-xs shadow-sm pll-algorithm"
        data-algorithm-name="{{ algorithm.name|lower }}"
      >
        <div class="card-body">
          <h2 class="card-title">{{ algorithm.name }}</h2>

          <div class="space-y-4">
            <!-- Image and description area -->
            <div class="flex gap-4 items-start">
              {% if algorithm.image_url is not none %}
              <div class="flex-shrink-0">
                <img
                  src="{{ algorithm.image_url }}"
                  alt="{{ algorithm.name }}"
                  class="w-24 h-24 rounded"
                  loading="lazy"
                />
              </div>
              {% endif %}

              <!-- Space for additional text/description -->
              <div class="flex-1 min-w-0 text-gray-300 text-sm">
                <!-- This is where you can add description or notes about the algorithm -->
                <p>Algorithm description or notes can go here...</p>
              </div>
            </div>

            <!-- Moves list below -->
            <div>
              <ul
                class="border border-gray-600 rounded overflow-hidden list-none m-0 p-0"
              >
                {% for move in algorithm.moves %}
                <li
                  class="font-mono text-sm text-gray-100 px-3 py-2 {% if not loop.last %}border-b border-gray-600{% endif %}"
                >
                  {{ move }}
                </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  function showSection(section) {
    // Hide all sections
    const sections = document.querySelectorAll(".algorithm-section");
    sections.forEach((sec) => sec.classList.add("hidden"));

    // Show the selected section
    document.getElementById(section + "-section").classList.remove("hidden");

    // Update button styles - remove active class from all
    const buttons = document.querySelectorAll(".nav-button");
    buttons.forEach((btn) => {
      btn.classList.remove("active");
    });

    // Add active class to selected button
    const activeBtn = document.getElementById(section + "-btn");
    activeBtn.classList.add("active");

    // Save the selected section to localStorage
    localStorage.setItem("selectedCfopSection", section);
  }

  // Initialize with previously selected section or default to F2L
  document.addEventListener("DOMContentLoaded", function () {
    const savedSection = localStorage.getItem("selectedCfopSection") || "f2l";
    showSection(savedSection);

    // Calculate and set the real header height
    const header = document.querySelector("header");
    if (header) {
      const headerHeight = header.offsetHeight;
      document.documentElement.style.setProperty(
        "--header-height",
        headerHeight + "px"
      );
    }
  });

  // PLL Search functionality
  function filterPLLAlgorithms() {
    const searchTerm = document
      .getElementById("pll-search")
      .value.toLowerCase();
    const pllAlgorithms = document.querySelectorAll(".pll-algorithm");
    const pllGroups = document.querySelectorAll(".pll-group");

    console.log("Search term:", searchTerm);

    pllAlgorithms.forEach((algorithm) => {
      const algorithmName = algorithm.getAttribute("data-algorithm-name");
      console.log(
        "Checking algorithm:",
        algorithmName,
        "starts with:",
        algorithmName.startsWith(searchTerm)
      );

      // Strict matching: first character must match
      if (searchTerm === "" || algorithmName.startsWith(searchTerm)) {
        algorithm.style.display = "block";
      } else {
        algorithm.style.display = "none";
      }
    });

    // Hide groups that have no visible algorithms
    pllGroups.forEach((group) => {
      const algorithmsInGroup = group.querySelectorAll(".pll-algorithm");
      let hasVisibleAlgorithm = false;

      algorithmsInGroup.forEach((algo) => {
        if (algo.style.display !== "none") {
          hasVisibleAlgorithm = true;
        }
      });

      if (searchTerm === "" || hasVisibleAlgorithm) {
        group.style.display = "block";
      } else {
        group.style.display = "none";
      }
    });
  }

  // Clear PLL search function
  function clearPLLSearch() {
    const searchInput = document.getElementById("pll-search");
    const clearButton = document.getElementById("pll-search-clear");

    searchInput.value = "";
    clearButton.classList.add("hidden");
    filterPLLAlgorithms(); // Reset the filter
  }

  // Toggle clear button visibility
  function toggleClearButton() {
    const searchInput = document.getElementById("pll-search");
    const clearButton = document.getElementById("pll-search-clear");

    if (searchInput.value.length > 0) {
      clearButton.classList.remove("hidden");
    } else {
      clearButton.classList.add("hidden");
    }
  }

  // Add event listener for PLL search
  document.addEventListener("DOMContentLoaded", function () {
    const pllSearchInput = document.getElementById("pll-search");
    if (pllSearchInput) {
      pllSearchInput.addEventListener("input", function () {
        filterPLLAlgorithms();
        toggleClearButton();
      });
    }
  });
</script>
{% endblock %}
